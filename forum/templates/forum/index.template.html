{% extends 'base.template.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
<div class="text-center">
    <h1>Forum</h1>
    <p>
        Ask and answer questions here!
    </p>
</div>
   
<form method="GET">
    {{search_form|crispy}}
    <input type="submit" value="Search"/>
</form>

{% if request.user.is_authenticated %}
<a href="{% url 'create_question' %}" class = "btn btn-primary">New Question</a>
{% endif %}

<div class = "container">
    {% for question in questions %}
    <div class="card mb-2 mainpost">
        <div class="card-body">
            <h4 class="card-title mb-3">{{question.title}} <i>({{question.course}})</i></h4>
            <p class="card-title ml-3">{{question.content}}</p>
            <p class="blockquote-footer card-text ml-3">Posted by {{question.user.username}} at {{question.datetime|date:'d-M-Y H:i'}}</p>
        </div>
        <div class="text-right card-body">
        {% if request.user.is_authenticated %}
            {% if user.get_username == question.user.username %}
            <a href="{% url 'update_question' question_id=question.id %}" class="btn btn-primary card-link">Edit</a>
            <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#deleteQuestion{{question.id}}">Delete</button>
            {% else %}
            <a href="{% url 'create_answer' question_id=question.id %}" class="btn btn-secondary">Answer</a>
            {% endif %}
        {% endif %}
        </div>
        
        {% for answer in question.answer_set.all %}
        <div class="card-footer subpost text-right">
            <div>
                <p class="card-text mr-3">{{answer.content}}</p>
                <p class="blockquote-footer mr-3">Posted by {{answer.user.username}} at {{answer.datetime|date:'d-M-Y H:i'}}</p>
            </div>
            {% if request.user.is_authenticated %}
                {% if user.get_username == answer.user.username %}
            <div>
                <a href="{% url 'update_answer' answer_id=answer.id %}" class="btn btn-primary">Edit</a>
                <a href="{% url 'delete_answer' answer_id=answer.id %}" class="btn btn-danger">Delete</a>
            </div>
                {% endif %}
            {% endif %}
        </div>
        {% endfor %}
    </div>
    
    <div class="modal fade" id="deleteQuestion{{question.id}}" tabindex="-1" aria-labelledby="deleteQuestionLabel" aria-hidden="true">
        <div class="modal-dialog">
                <div class="modal-content">
                <form method="POST" action="{% url 'delete_question' question_id=question.id %}">
                    {% csrf_token %}
                    <div class="modal-header">
                        <h5 class="modal-title danger" id="deleteQuestionLabel">WARNING!</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>This action cannot be undone.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-danger">Delete</button>
                    </div>
                </form>		
            </div>	
        </div>
    </div>
    {% endfor %}
</div>

{% endblock %}

{% block js %}
<script>
	$("#navbar-forum").addClass("active");
</script>
{% endblock %}
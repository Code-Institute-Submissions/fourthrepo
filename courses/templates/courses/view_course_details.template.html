{% extends 'base.template.html' %}
{% load crispy_forms_tags %}
{%load static %}

{% block content %}
<div class="text-center">
	<h1>{{course.title}}</h1>
	<img src="{{course.logo_url}}" class="img-fluid" style="max-width: 200px;" alt="logo image">
</div>
<div class='text-center'>
	<p>{{course.description}}</p>
	<h3>Taught By</h3>
	<ul>
	{% for tutor in course.tutors.all %}
	<li>{{tutor.first_name}} {{tutor.last_name}}</li>
	{% endfor %}
	</ul>
	
</div>
	
	<!--Reviews Section-->
	<h3>Reviews</h3>
	<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#createReview">
		New Review
	</button>
	{% for r in course.review_set.all %}
	<div class="card review-id" data-review-id = "{{r.id}}">
		<div class = "card-body">
			<div class="card-title">
				<h3 class="review-title">{{r.title}}</h3>
			</div>
			<div class="review-content">
				{{r.content}}
			</div>
			<p class="blockquote-footer">Posted by {{r.user.username}} at {{r.datetime|date:'d-M-Y H:i'}}</p>
		</div>
		<div class="text-right">
			{% if user.get_username == r.user.username  %}
			<a href="{% url 'update_review' review_id=r.id %}" class="btn btn-primary">Edit</a>
			<button type="button" class="btn btn-danger" data-toggle="modal" data-target="#deleteReview{{r.id}}">Delete</button>
			{% else %}
			<a href="{% url 'create_comment' review_id=r.id %}" class="btn btn-secondary">Comment</a>
			{% endif %}
		</div>
		{% for comment in r.comment_set.all %}
		<div class = "card">
			<div class = "card-footer text-right">
				{{comment.text}}
				<p class="blockquote-footer">Posted by {{comment.user.username}} at {{comment.datetime|date:'d-M-Y H:i'}}</p>
			</div>
		</div>
		{% endfor %}
	</div>


	<!-- Delete Review -->
	<div class="modal fade" id="deleteReview{{r.id}}" tabindex="-1" aria-labelledby="deleteReviewLabel" aria-hidden="true">
		<div class="modal-dialog">
		  	<div class="modal-content">
				<form method="POST" action="{% url 'delete_review' review_id=r.id %}">
					{% csrf_token %}
					<div class="modal-header">
						<h5 class="modal-title danger" id="deleteReviewLabel">WARNING!</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<p>This action cannot be undone.</p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-danger">Delete</button>
					</div>
				</form>		
			</div>	
		</div>
	</div>
	{% endfor %}

	<!-- Create Review Form -->
	<div class="modal fade" id="createReview" tabindex="-1" aria-labelledby="createReviewLabel" aria-hidden="true">
		<div class="modal-dialog">
		  	<div class="modal-content">
				<form method="POST" action="{% url 'create_review' course_id=course.id %}">
					<div class="modal-header">
						<h5 class="modal-title" id="createReviewLabel">New Review</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close" onClick="this.form.reset()">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
					{% csrf_token %}
					{{ form|crispy}}
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal" onClick="this.form.reset()">Dismiss</button>
						<button type="submit" class="btn btn-primary">Submit</button>
					</div>
				</form>		
			</div>	
		</div>
	</div>
{% endblock %}

{% block js %}
<script>
	$("#navbar-courses").addClass("active");
</script>
{% endblock %}
{% extends 'base.template.html' %}
{% load crispy_forms_tags %}
{%load static %}

{% block content %}
	<h1>{{course.title}}</h1>
	<img src="{{course.logo_url}}" alt="logo image">
	<h3>Taught By</h3>
	<ul>
	{% for tutor in course.tutors.all %}
	<li>{{tutor.first_name}} {{tutor.last_name}}</li>
	{% endfor %}
	</ul>
	<p>{{course.description}}</p>

	<!--Reviews Section-->
	<h3>Reviews</h3>
	<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#createReview">
		New Review
	</button>
	{% for r in course.review_set.all %}
	<div class="card">
		<div class = "card-body">
			<div class="card-title">
				<h3>{{r.title}}</h3>
			</div>
			<div>
				{{r.content}}
			</div>
			<p class="blockquote-footer">Posted by {{r.user.username}} at {{r.datetime|date:'d-M-Y H:i'}}</p>
		</div>
		<div class="text-right">
			<!-- <a href="{% url 'update_review' review_id=r.id %}" class="btn btn-primary">Edit</a> -->
			<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#updateReview{{r.id}}">Edit</button>
			<button type="button" class="btn btn-danger" data-toggle="modal" data-target="#deleteReview{{r.id}}">Delete</button>
		</div>
	</div>


	<!-- Delete Review -->
	<div class="modal fade" id="deleteReview{{r.id}}" tabindex="-1" aria-labelledby="deleteReviewLabel" aria-hidden="true">
		<div class="modal-dialog">
		  	<div class="modal-content">
				<form method="POST" action="{% url 'delete_review' review_id=r.id %}">
					{% csrf_token %}
					<div class="modal-header">
						<h5 class="modal-title danger" id="deleteReviewLabel">WARNING!</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<p>This action cannot be undone.</p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-danger">Delete</button>
					</div>
				</form>		
			</div>	
		</div>
	</div>


	<!-- Update Review -->
	<div class="modal fade" id="updateReview{{r.id}}" tabindex="-1" aria-labelledby="updateReviewLabel" aria-hidden="true">
		<div class="modal-dialog">
		  	<div class="modal-content">
				<form method="POST" action="{% url 'update_review' review_id=r.id %}">
					<div class="modal-header">
						<h5 class="modal-title" id="updateReviewLabel">Edit Review</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
					{% csrf_token %}
					{{ form|crispy}}
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Dismiss</button>
						<button type="submit" class="btn btn-primary">Update</button>
					</div>
				</form>		
			</div>	
		</div>
	</div>

	{% endfor %}

	<!-- Create Review Form -->
	<div class="modal fade" id="createReview" tabindex="-1" aria-labelledby="createReviewLabel" aria-hidden="true">
		<div class="modal-dialog">
		  	<div class="modal-content">
				<form method="POST" action="{% url 'create_review' course_id=course.id %}">
					<div class="modal-header">
						<h5 class="modal-title" id="createReviewLabel">New Review</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close" onClick="this.form.reset()">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
					{% csrf_token %}
					{{ form|crispy}}
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal" onClick="this.form.reset()">Dismiss</button>
						<button type="submit" class="btn btn-primary">Submit</button>
					</div>
				</form>		
			</div>	
		</div>
	</div>


	<!-- Delete Form -->
	
{% endblock %}

{% block js %}
<script>
	$("#navbar-courses").addClass("active");
</script>
{% endblock %}